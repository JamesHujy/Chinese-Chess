# Chinese-Chess

一款中国象棋在线对战平台
运⾏程序之后，会进⼊到游戏主封⾯。封⾯面中有两个按键。一个按键可以创建一个房间(对应server端)，另一个按键可以加⼊到一个房间(对应client端)。双⽅需 要一⼈创建房间，另一人加入到对应的房间才能开始游戏。    
选择创建房间，会弹出的对话框。对话框会自动识别出本机的IP地址，用户只需要设置端口号就可以。设置好之后，就会弹出等待连接的对话框。此时点击cancel可以取消创建。如果选择加⼊房间，则需要输⼊对⽅的IP地址和端口号。 输⼊正确的话，就可以建立连接进入到游戏界⾯。   
当双⽅都准备好时，游戏会自动开始。此时会出现计时器，显示本步所剩余的时间。同时提示当前该由哪⼀方下。    
在菜单栏中，开始栏设有new game和begin，操作栏设有save，import，give up和退出。同时这些操作也在工具栏中进行了同步。

## 主要功能
1. ⽹络在线对战功能。server端将⾃动显示IP，client输⼊server端IP和端口号就可以相互连接。连接成功后，对⽅和本⽅的⾛棋可以实时相互显示，两⽅方棋盘呈中心对称。
2. 象棋规则实现。程序对象棋每种棋⼦的规则进⾏了实现。 但有⾮法⾛法时，会发出特殊⾳效进⾏提醒。只有合法操作会被允许。
3. 准备功能。进⼊界⾯之后，双⽅都显示等待准备状态，点击开始之后，表示本方已经准备。双方都开始后
4. 将军判断。当局⾯上出现将军时，会发出“将军”声音提醒。
5. 超时判断。但单步思考超过规定时间时，会对超时⽅显示已超时且输棋的对话框提醒。⽽而另⼀⽅则显示已获胜。
6. 认输功能。当⼤势已去时，⼀⽅可以提出认输。点击认输键之后，会有一个对话框，让用户确定是否要认输。认输后，会弹出相应对话框提醒另一方。
7. 特殊⾳效。但将军时，会发出“将军”音效。每一步时，没有吃⼦和吃子会分别发出相应的⾳效。开始时，会发出棋⼦掉落的声音。决出输赢之后，也会分别表示遗憾和表示欢呼的声⾳。
8. 局⾯保存，对应save操作。对局进⾏过程中，可以随时保存当前局面。保存的⽂件格式为txt，⽂件分两部分，分别记录红方和⿊方。当前的轮次方会被先记录。⽂件的每一部分第⼀⾏代表颜⾊，接下来有7⾏，分别代表将/⼠/象/马/⻋/炮/兵的棋⼦位置每⾏第一个数代表该种棋子的数量n，代表该类棋⼦的数目，之后会有n个格式为<x,y> 的坐标，代表n个棋⼦的位置。(坐标原点为红⽅的左下点，记作<0,0>)
9. 局⾯导⼊，对于import操作。在准备前，可以选择导⼊残局，导⼊的⽂件要求与上述存储⽂件的格式相同。导⼊时， 先录⼊的一⽅为先⾏方。导⼊后，同样需要双⽅准备。

## 设计思路
### 整体框架
* Board类实现整个棋盘的绘制，规则判断等功能。global.h中定义了了⼀一些通⽤用的static const，例例如对每个棋⼦子进⾏行行编号，对属于⽅进⾏说明，从⽽提⾼代码的可读性。 Initialcover类设计了游戏的封面。 mainwindow类中主要实现server端和client端连接的建⽴，传输信息的发送和接收。

### socket通信
* 本程序的通信⽅式主要采用socket通信，以TCP协议为基础。参考课上⽼师提供的源代码，只要输入正确的IP地址和端⼝号就可以建⽴连接。以下主要说明传输信息时的编码方式。    
传输的信息主要分为两种，一种是传递当前棋盘的状态。另一种是传递某种信号，例如对⼿已认输。   
* 棋盘的存储⽅式是一个一维int指针类型Map，从红⽅视⻆棋盘的左上⽅开始，若该点有棋⼦，则为该棋⼦的编号，为没有则为0。传输时，我的方式是传递一个与Map等⻓的 QString类型，int的每一个值+30作为ascii码对应相应的字符。这样传递一个⻓度为90。通过ascii码，编码和解码都⽐较容易。
  如果传递信号，则直接传递信号含义的英文字符串。
  
### 规则判断
* 这个程序中最麻烦的就是象棋各个棋⼦子⾛法是否合法的判断。由于象棋各种棋⼦的⾛法都完全不同，所以只好分别来写，除了⻋和炮之外，其他棋子⾛法都较为局部，较为好写。⻋和炮的判断⽅式是:⾸先判断是否在同一⾏或同⼀列， 如果不在直接判断不合法，如果在，判断目的地与当前位置之间棋⼦的个数。
* 另外有一些特殊规则，⽐如说⻢和象是否能正常走。
* 简单介绍一下对于将军的判断。由于将军只有可能是⻋、⻢、炮或者卒。分别列举当前棋盘上这些棋子的位置。 然后假设主帅为目的地，这些棋⼦是当前位置，套用上述的判断是否合法的函数就可以判断是否将军。
  


